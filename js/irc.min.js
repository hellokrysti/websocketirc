var user_icon='<svg version="1.1" id="irc_users" x="0px" y="0px" width="15" height="15" viewBox="0 0 611.999 612"><g><path fill="darkcyan" d="M416.5,497.25v40.627c0,6.021-4.434,13.02-9.935,15.468c-21.321,9.486-79.477,28.905-198.315,28.905c-118.839,0-176.995-19.419-198.316-28.905C4.433,550.897,0,543.898,0,537.876V497.25c0-60.88,46.353-111.387,105.5-118.15c1.797-0.206,4.462,0.563,5.927,1.624c27.271,19.743,60.658,31.526,96.824,31.526c36.167,0,69.553-11.783,96.824-31.526c1.465-1.061,4.131-1.83,5.928-1.624C370.147,385.863,416.5,436.37,416.5,497.25z M85,246.5c0-68.069,55.181-123.25,123.25-123.25c68.069,0,123.25,55.181,123.25,123.25c0,68.068-55.181,123.25-123.25,123.25C140.181,369.75,85,314.568,85,246.5z M149.935,295.417c5.607,18.538,29.624,32.474,58.409,32.474c28.785,0,52.803-13.936,58.41-32.474H149.935z M586.5,29.75h-204c-14.025,0-25.5,11.475-25.5,25.5v119.255c0,13.885,11.36,25.245,25.245,25.245h0.255v34c0,7.004,7.996,11.003,13.601,6.8l52.133-39.1c1.247-0.935,3.542-1.7,5.1-1.7H586.5c14.025,0,25.499-11.475,25.499-25.5v-119C612,41.225,600.525,29.75,586.5,29.75z"/></g></svg>';function createElementFromHTML(e){var i=document.createElement("div");return i.innerHTML=e.trim(),i.firstChild}var uicon=createElementFromHTML(user_icon),sif=document.createElement("div");sif.id="ircframe";var ic=document.createElement("div");ic.id="connect_irc",ic.classList.add("connect_irc"),ic.innerHTML="Nickname:";var inp=document.createElement("input");inp.name="nickname",inp.id="nickname",inp.type="text",inp.size=ircConfig.nicklen,inp.style.color="#b5b5b5",ic.appendChild(inp);var snick=document.createElement("input");snick.name="submit",snick.id="irc_connecting",snick.type="submit",snick.value="Connect!",snick.onclick=function(){connectWebSocket()},ic.appendChild(snick),sif.appendChild(ic);var itl=document.createElement("div");itl.id="itools",itl.classList.add("itools");var ils=document.createElement("span"),il=document.createElement("select");(io=document.createElement("option")).value="",io.innerHTML="-- Font Size --",il.appendChild(io),il.id="ifont",il.onchange=function(){cf(il.value)};for(var f=12;f<=20;f+=2){var io;(io=document.createElement("option")).innerHTML=f+"px",io.value=f+"px",il.appendChild(io)}ils.appendChild(il),itl.appendChild(ils);var iup=document.createElement("span");iup.id="iup",iup.innerHTML="▲",iup.onclick=function(){iAdjust(iup.id)},itl.appendChild(iup);var idown=document.createElement("span");idown.id="idown",idown.innerHTML="▼",idown.onclick=function(){iAdjust(idown.id)},itl.appendChild(idown),sif.appendChild(itl);var itp=document.createElement("div");itp.id="irctopic",itp.classList.add("irctopic");var iot=document.createElement("div");iot.id="output",iot.classList.add("output"),iot.style.height=ircConfig.output_height,iot.style.color=ircConfig.output_fc,sif.appendChild(itp),sif.appendChild(iot);var ist=document.createElement("div");ist.id="ircstatus",ist.classList.add("ircstatus");var inick=document.createElement("div");inick.id="s_nick";var idot=document.createElement("div");idot.innerHTML="&middot;";var ichannel=document.createElement("div");ichannel.id="s_channel";var isvg=document.createElement("div");isvg.innerHTML=uicon.outerHTML;var iusers=document.createElement("div");iusers.id="s_users",ist.appendChild(inick),ist.appendChild(idot),ist.appendChild(ichannel),ist.appendChild(isvg),ist.appendChild(iusers),sif.appendChild(ist);var ics=document.createElement("div");ics.id="ircsend",ics.classList.add("ircsend"),ics.style.display="none";var icsi=document.createElement("input");icsi.id="input",icsi.name="input",icsi.classList.add("send_text_irc"),icsi.autocomplete="off",icsi.value="Type your message here",icsi.style.color="#b5b5b5",icsi.style.background=ircConfig.input_bg,icsi.maxwidth="500",ics.appendChild(icsi),sif.appendChild(ics),document.getElementById(ircConfig.target).appendChild(sif);var ircConnected=0,currentHistory=0,ihistory=[],circ=document.getElementById("irc_connecting"),su=document.getElementById("s_users"),sn=document.getElementById("s_nick"),sc=document.getElementById("s_channel"),ircSettings={},nickname="",lbrk='<span class="y">&lt;</span>',rbrk='<span class="y">&gt;</span>',lbrku='<span class="g">&lt;</span>',rbrku='<span class="g">&gt;</span>',ii=0,extra_bit='<span style="color:red; font-weight:bold; letter-spacing:-1px;">.</span><span style="color:white; font-weight:bold; letter-spacing:-2px; margin-right:5px;">-- </span>',help_string='<section style="display:grid;grid-template-columns:auto 1fr"><div>/me</div><div>Send action command</div><div>/nick</div><div>Change nickname</div><div>/names</div><div>Show online users</div><div>/theme #</div><div>Set a theme to 0 through 7</div><div>/sbar #</div><div>Set a status bar colour to 0 through 7</div><div>/sbox #</div><div>Set an outline colour to 0 through 7</div><div>/scroll #</div><div>Set scrollbar colour to 0 through 7</div><div>/save</div><div>Save theme settings</div><div>Up key</div><div>Scrollback typed history</div><div>Supported Media URLs:</div><div>jpg,png,gif,webp and mp4,ogg,ogv</div></section>',ehelp=createElementFromHTML(help_string);function sbar(e){!isNaN(e)&&e<ircConfig.max_themes&&(ist.classList.value=ist.classList.value.replace(/sbar[0-9]/g,""),ist.classList.add("sbar"+e),ircSettings.sbar=e)}function sbox(e){if(!isNaN(e)&&e<ircConfig.max_themes){var i=document.getElementById(ircConfig.target);i.classList.value=i.classList.value.replace(/sbox[0-9]/g,""),i.classList.add("sbox"+e),ircSettings.sbox=e}}function oscroll(e){!isNaN(e)&&e<ircConfig.max_themes&&(iot.classList.value=iot.classList.value.replace(/oscroll[0-9]/g,""),iot.classList.add("oscroll"+e),ircSettings.oscroll=e)}function setTheme(e){!isNaN(e)&&e<ircConfig.max_themes&&(writeToScreen("<span>"+extra_bit+" Setting theme to "+e+"</span>"),sbar(e),sbox(e),oscroll(e))}function saveTheme(){writeToScreen("<span>"+extra_bit+" Saving theme settings</span>"),localStorage.ircSettings=JSON.stringify(ircSettings)}function cf(e){iot.style.fontSize=e,iot.scrollTop=iot.scrollHeight}function iAdjust(e){console.log("iAdjust",e);var i=iot.clientHeight;switch(e){case"iup":iot.style.height=i-20+"px";break;case"idown":iot.style.height=i+10+"px"}iot.scrollTop=iot.scrollHeight}function resizeChat(){var e=window.innerHeight-(itp.clientHeight+ist.clientHeight+ics.clientHeight);console.log("output height",e),iot.style.height=e+"px";var i=window.innerHeight,t=i-e;iot.style.height=e+"px",console.log("height:",e,i,t),iot.scrollTop=iot.scrollHeight}function outputHandle(){1==ircConnected&&(ist.clientWidth>256?(document.querySelector("#ircstatus > div:nth-child(2)").style.display="initial",document.querySelector("#ircstatus > div:nth-child(3)").style.display="initial"):(document.querySelector("#ircstatus > div:nth-child(2)").style.display="none",document.querySelector("#ircstatus > div:nth-child(3)").style.display="none"))}function escapeHtml(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return i[e]}))}function connectWebSocket(){websocket=new WebSocket("wss://"+ircConfig.server+":"+ircConfig.port),websocket.onopen=function(e){onOpen(e)},websocket.onclose=function(e){onClose(e)},websocket.onmessage=function(e){onMessage(e)},websocket.onerror=function(e){onError(e)},nickname=inp.value}function onOpen(e){ic.style.display="none",ics.style.display="flex",iot.style.display="block",ist.style.display="flex",itp.style.display="block",itl.style.display="flex",localStorage.ircSettings?(sbar((ircSettings=JSON.parse(localStorage.ircSettings)).sbar),sbox(ircSettings.sbox),oscroll(ircSettings.oscroll)):""!=ircConfig.default_theme&&(console.log("Loading default theme"),sbar(ircConfig.default_theme),sbox(ircConfig.default_theme),oscroll(ircConfig.default_theme)),iot.scrollTop=iot.scrollHeight,writeToScreen("Welcome to "+ircConfig.network+" (IRC Network)"),1==ircConfig.ircv3&&(doSend("cap ls 302"),doSend("cap list"),doSend("cap req :batch message-tags account-tag server-time draft/chathistory")),doSend("user "+ircConfig.ident+" * 0 :"+ircConfig.network),doSend("nick "+inp.value),1==ircConfig.ircv3&&doSend("cap end"),s_nick.innerHTML=inp.value,-1==inp.value.indexOf(ircConfig.guest_prefix+"Guest_")&&(localStorage.setItem("nickname",inp.value),inp.style.color="#000"),ircConnected=1}function onClose(e){ircConnected=0,ic.style.display="flex",ics.style.display="none",iot.style.display="none",ist.style.display="none",itp.style.display="none",itl.style.display="none",snick.value="Connect",snick.style.color="black",snick.disabled="",writeToScreen("DISCONNECTED")}function onMessage(e){if(rawData=e.data,rawData instanceof Blob){var i=new FileReader;i.addEventListener("loadend",handleBinaryInput),i.readAsText(rawData)}else process(rawData)}function handleBinaryInput(e){process(e.target.result)}function process(e){var i,t;if("@"==e.substring(0,1)&&(t=(i=e.split(" "))[0],i.shift(),console.log("IRCv3 info",t),e=i.join(" ")),0==e.indexOf("PING"))pongResponse=e.replace("PING","PONG"),websocket.send(pongResponse);else if(e.indexOf("001")>-1)doSend("join "+ircConfig.channel),1==ircConfig.ircv3&&doSend("CHATHISTORY LATEST "+ircConfig.channel+" * "+ircConfig.playback);else if("ERROR"==e.substring(0,5))return void writeToScreen('<span style="color:red;font-weight:bold;">'+e.substring(6).replace(/[:]/g,"")+"</span>");console.log("Raw IRC",escapeHtml(e));var n=e.substring(1,e.indexOf(":",1)-1).split(" "),s=e.substring(1).split(" "),o=n[0].split("!")[0],c=e.substring(e.slice(1).indexOf(":")+2);switch(s[1]){case"PRIVMSG":if(console.log("Msg",c),0==(c=escapeHtml(c)).indexOf("")){if(console.log("Raw IRC",escapeHtml(e)),c=c.replace(/[\u0001]/g,"").substring(c.indexOf(" ")),cparams=escapeHtml(e).replace(/[\u0001]/g,"").replace(/[:]/g,"").split(" "),console.log("cparams",cparams),n[2]!=ircConfig.channel){var a=n[0].substring(0,n[0].indexOf("!"));switch(cparams[3]){case"VERSION":doSend("NOTICE "+a+" :"+String.fromCharCode(1)+"VERSION https://krysti.engineer Websocket IRC v0.2"+String.fromCharCode(1));break;case"PING":doSend("NOTICE "+a+" :"+String.fromCharCode(1)+"PING "+cparams[4]+" "+cparams[5]+String.fromCharCode(1));break;case"TIME":var r=(new Date).toLocaleDateString("en-us",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timezone:"America/New_York"});doSend("NOTICE "+a+" :"+String.fromCharCode(1)+"TIME "+r+" EST"+String.fromCharCode(1))}}else writeToScreen('<span style="color:#da00f4;">* '+o+" "+c+"</span><br/>");break}writeToScreen("<div>"+lbrk+"<span>"+o+"</span>"+rbrk+"</div><div>"+imageify(c)+"</div>");break;case"372":writeToScreen("<span>"+extra_bit+c.substring(2)+"</span>");break;case"BATCH":break;case"353":var l='<div class="who" id="who"><div>Users Online: </div>',d=c.split(" "),p=Number();for(p=0;p<d.length;p++){var u="";switch(d[p].substring(0,1)){case"~":u="color:#ff00f7";break;case"&":u="color:red";break;case"@":u="color:yellow";break;case"%":u="color:cyan";break;default:u="color:white"}l=l+"<div style='"+u+"'>"+d[p]+"</div>"}l+="</div>",iusers.innerHTML=p,writeToScreen(l);break;case"366":outputHandle();break;case"332":itp.innerHTML=c,writeToScreen("<span>Topic: "+c+"</span>");break;case"333":writeToScreen("<span>"+extra_bit+"Topic set by "+s[4]+" at "+Date(s[5]).split(" ",6).join(" ")+"</span>");break;case"NICK":console.log("Raw Nick",escapeHtml(e),o,inick.innerHTML,c,inp.value),o==sn.innerHTML&&c==inp.value?(writeToScreen("*** YOU changed your name to "+c),inick.innerHTML=c,-1==(nickname=c).indexOf(ircConfig.guest_prefix+"Guest_")&&localStorage.setItem("nickname",nickname)):writeToScreen("*** "+o+" is now "+c);break;case"KICK":n[3]==inp.value&&websocket.close(),iusers.innerHTML=parseInt(iusers.innerHTML)-1,writeToScreen("*** "+o+" kicked "+n[3]);break;case"QUIT":iusers.innerHTML=parseInt(iusers.innerHTML)-1;break;case"JOIN":o==inp.value&&(ichannel.innerHTML=s[2].substring(1)),iusers.innerHTML=parseInt(iusers.innerHTML)+1;break;case"TOPIC":itp.innerHTML=c}}function onError(e){writeToScreen('<span style="color: red;">ERROR:</span> '+e.data)}function doSend(e){var i=e.split(" ",1),t=e.substring(e.indexOf(":")+1);if(0==(t=escapeHtml(t)).length)return writeToScreen("Error: Write something"),0;switch(i[0]){case"privmsg":writeToScreen("<div>"+lbrku+"<span>"+inp.value+"</span>"+rbrku+"</div><div>"+imageify(t)+"</div>");break;case"me":t=t.replace(/[\u0001]/g,"").substring(t.indexOf(" ")),writeToScreen('<span style="color:#da00f4;">* '+inp.value+" "+t+"</span>"),e="privmsg"+e.substring(2)}websocket.send(e+"\n")}function writeToScreen(e){var i=document.createElement("div");i.innerHTML=e,iot.appendChild(i),iot.scrollTop=iot.scrollHeight}function doSlash(e){var i=e.split(" ")[0].toLowerCase(),t=e.substring(e.indexOf(" ")+1),n=e.split(" ");n=n.filter((function(e){return""!=e})),console.log("Parama",n);var s=n.length;switch(i){case"me":s>1?doSend("me "+ircConfig.channel+" :"+String.fromCharCode(1)+"ACTION "+t+String.fromCharCode(1)):writeToScreen('<span style="color:red;">ERROR: Please enter an action to convey.</span><br />');break;case"nick":s>1?(inp.value=t.split(" ")[0],doSend("nick "+t)):writeToScreen('<span style="color:red;">ERROR: Please enter a nickname.</span><br />');break;case"users":case"names":doSend("names "+ircConfig.channel);break;case"help":iot.appendChild(ehelp),iot.scrollTop=iot.scrollHeight;break;case"theme":setTheme(n[1]);break;case"sbar":sbar(n[1]),writeToScreen("<span>"+extra_bit+" Setting statusbar to theme "+n[1]+"</span>");break;case"sbox":sbox(n[1]),writeToScreen("<span>"+extra_bit+" Setting client outline to theme "+n[1]+"</span>");break;case"scroll":oscroll(n[1]),writeToScreen("<span>"+extra_bit+" Setting scrollbar to theme "+n[1]+"</span>");break;case"save":saveTheme()}icsi.value=""}function send(){ihistory.push(input.value),ihistory.length>20&&ihistory.shift(),"/"==icsi.value.substring(0,1)?doSlash(icsi.value.substring(1)):(doSend("privmsg "+ircConfig.channel+" :"+icsi.value),icsi.value="")}function hasClass(e,i){return e.classList?e.classList.contains(i):new RegExp("\\b"+i+"\\b").test(e.className)}function addClass(e,i){e.classList?e.classList.add(i):hasClass(e,i)||(e.className+=" "+i)}function removeClass(e,i){e.classList?e.classList.remove(i):e.className=e.className.replace(new RegExp("\\b"+i+"\\b","g"),"")}function imageify(e){for(var i=e.split(" "),t=0;t<i.length;t++)if(-1!=i[t].indexOf("http")){if(-1!=i[t].indexOf("?"))var n=i[t].substring(i[t].lastIndexOf(".")+1,i[t].indexOf("?")).toLowerCase();else n=i[t].substring(i[t].lastIndexOf(".")+1).toLowerCase();switch(n){case"jpg":case"png":case"gif":case"webp":var s=document.createElement("img");s.id="shared_"+ii,s.src=i[t],s.style.maxWidth=ircConfig.max_image_width,i[t]=s.outerHTML;break;case"ogg":case"ogv":case"mp4":(d=document.createElement("div")).style.maxWidth=ircConfig.max_video_width,(u=document.createElement("div")).classList.add("videoWrapper");var o=document.createElement("video"),c=document.createElement("source");o.width="200",o.height="140",o.controls=!0,o.volume=.5,c.src=i[t],c.type="video/mp4",o.appendChild(c),u.appendChild(o),d.appendChild(u),i[t]=d.outerHTML}switch(i[t].substring(0,i[t].indexOf(":"))){case"https":case"http":var a=i[t].substring(i[t].indexOf("/")+2,i[t].lastIndexOf("/"));if("youtube.com"==a||"www.youtube.com"==a){var r=i[t].substring(i[t].lastIndexOf("?")+1).split("&");for(p=0;p<r.length;p++){var l=r[p].split("=");if(l[1]&&"v"==l[0]){var d,u;console.log("YT ID",l[1]),(d=document.createElement("div")).style.maxWidth="240px",(u=document.createElement("div")).classList.add("videoWrapper");var g=document.createElement("iframe");g.frameBorder=0,g.width=200,g.height=140,g.src="https://www.youtube.com/embed/"+l[1],u.appendChild(g),d.appendChild(u),i[t]=d.outerHTML}}break}i[t]='<a href = "'+i[t]+'" target="_new">'+i[t]+"</a>"}s&&s.addEventListener("load",(function(){console.log("Loaded image ",ii,this.id),iot.scrollTop=iot.scrollHeight,document.getElementById(this.id).onclick=function(){enlarge_image(this)}})),ii++}return console.log(i.join(" ")),i.join(" ")}function enlarge_image(e){console.log("Clicked image",e.id),""==e.style.maxWidth?e.style.maxWidth=ircConfig.max_image_width:e.style.maxWidth="",iot.scrollTop=iot.scrollHeight}icsi.addEventListener("mousedown",(function(){"white"!=icsi.style.color&&(icsi.value="",icsi.style.color="white")})),ic.addEventListener("click",(function(){ic.value="Connecting, please wait",ic.style.color="white",ic.disabled="disabled"})),inp.addEventListener("click",(function(){inp.select()})),inp.addEventListener("input",(function(){""!=inp.value?inp.style.color="#000":(inp.value=ircConfig.guest_prefix+"Guest_"+Math.floor(1e5*Math.random()+1).toString(),inp.style.color="#b5b5b5",inp.select())})),window.addEventListener("resize",(function(e){console.log(document.body.clientWidth+" wide by "+document.body.clientHeight+" high"),outputHandle(),iot.scrollTop=iot.scrollHeight})),icsi.addEventListener("keydown",(function(e){13===e.keyCode&&(send(),currentHistory=ihistory.length-1,e.preventDefault()),38===e.keyCode&&(currentHistory<0?(currentHistory=ihistory.length,icsi.value=""):(icsi.value=ihistory[currentHistory],icsi.setSelectionRange(icsi.value.length,icsi.value.length),icsi.focus()),currentHistory-=1,e.preventDefault())})),localStorage.nickname?(inp.value=localStorage.nickname,inp.style.color="#000"):inp.value=ircConfig.guest_prefix+"Guest_"+Math.floor(1e5*Math.random()+1).toString();
